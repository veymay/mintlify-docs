---
title: "OWASP Top 10 va Veb Zaifliklar"
description: "Eng keng tarqalgan veb xavfsizlik muammolari"
---

## TODO
- OWASP Top 10 ni o'rganish
- Veb zaifliklarni tushunish
- Himoya usullarini bilish

## Dars mazmuni

### OWASP nima?

**OWASP** (Open Web Application Security Project) - veb xavfsizlik bo'yicha xalqaro tashkilot.

**OWASP Top 10** - eng keng tarqalgan veb zaifliklar ro'yxati.

### 1. Injection

**SQL Injection** - eng xavfli zaiflik.

#### SQL Injection nima?

**Tushuntirish**: Foydalanuvchi kiritgan ma'lumot SQL so'rovga qo'shiladi.

**Zaif kod**:

```php
// PHP misoli
$username = $_POST['username'];
$password = $_POST['password'];

$sql = "SELECT * FROM users WHERE username='$username' AND password='$password'";
$result = mysqli_query($conn, $sql);
```

**Hujum**:

```
Username: admin' OR '1'='1
Password: anything

SQL: SELECT * FROM users WHERE username='admin' OR '1'='1' AND password='anything'
```

**Natija**: `'1'='1'` har doim true, demak har qanday parol bilan kirish mumkin!

#### SQL Injection turlari

**1. Error-based**:
```sql
' OR 1=1 --
```

**2. Union-based**:
```sql
' UNION SELECT NULL, username, password FROM users --
```

**3. Blind SQL Injection**:
```sql
' AND (SELECT COUNT(*) FROM users) > 0 --
```

**4. Time-based**:
```sql
' OR IF(1=1, SLEEP(5), 0) --
```

#### Himoya usullari

**1. Prepared Statements** (eng yaxshi):

```php
// PDO
$stmt = $pdo->prepare("SELECT * FROM users WHERE username = ? AND password = ?");
$stmt->execute([$username, $password]);
```

```python
# Python
cursor.execute("SELECT * FROM users WHERE username = ? AND password = ?", (username, password))
```

**2. Input Validation**:

```php
// Faqat harflar va raqamlar
if (!preg_match('/^[a-zA-Z0-9]+$/', $username)) {
    die("Invalid username");
}
```

**3. Escape qilish**:

```php
$username = mysqli_real_escape_string($conn, $username);
```

**4. ORM ishlatish**:

```javascript
// Sequelize (Node.js)
User.findOne({
    where: {
        username: req.body.username,
        password: req.body.password
    }
});
```

#### Boshqa Injection turlari

**Command Injection**:

```php
// Zaif
$ip = $_GET['ip'];
system("ping -c 4 $ip");

// Hujum
?ip=8.8.8.8; cat /etc/passwd
```

**LDAP Injection**, **XML Injection**, **XPath Injection**

### 2. Broken Authentication

**Autentifikatsiya muammolari** - parol va sessiya boshqaruvida xatoliklar.

#### Zaif parollar

**Muammo**:
- Oddiy parollar: `123456`, `password`, `admin`
- Brute-force hujumlariga ochiq
- Parol talablari yo'q

**Himoya**:

```javascript
// Parol qoidalari
const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

// Minimal 8 belgi
// Katta harf, kichik harf, raqam, maxsus belgi
```

**Hash qilish**:

```php
// PHP - bcrypt
$hashed = password_hash($password, PASSWORD_BCRYPT);

// Tekshirish
if (password_verify($password, $hashed)) {
    // To'g'ri
}
```

```python
# Python - bcrypt
import bcrypt

hashed = bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt())

# Tekshirish
if bcrypt.checkpw(password.encode('utf-8'), hashed):
    # To'g'ri
```

#### Session Management

**Zaif sessiya**:

```php
// Xavfli
session_start();
$_SESSION['user_id'] = $user_id;
$_SESSION['is_admin'] = true;
```

**Muammolar**:
- Session ID predictable
- Session Fixation
- Session Hijacking

**Himoya**:

```php
// Session regeneration (har safar login qilganda)
session_regenerate_id(true);

// Secure cookie flags
session_set_cookie_params([
    'lifetime' => 3600,
    'path' => '/',
    'domain' => 'example.com',
    'secure' => true,      // Faqat HTTPS
    'httponly' => true,    // JavaScript dan himoya
    'samesite' => 'Strict' // CSRF dan himoya
]);
```

#### Two-Factor Authentication (2FA)

**Qo'shimcha himoya qatlami**:

1. Parol
2. SMS kod / Authenticator app

```javascript
// Google Authenticator misoli
const speakeasy = require('speakeasy');

// Secret yaratish
const secret = speakeasy.generateSecret({
    name: 'MyApp (user@example.com)'
});

// Verify
const verified = speakeasy.totp.verify({
    secret: secret.base32,
    encoding: 'base32',
    token: userToken
});
```

### 3. Sensitive Data Exposure

**Sezgir ma'lumotlar** - maxfiy ma'lumotlarning oshkor bo'lishi.

#### HTTPS

**HTTP dan HTTPS ga o'tish**:

```nginx
# Nginx
server {
    listen 80;
    server_name example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl;
    server_name example.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    # Zamonaviy TLS versiyalar
    ssl_protocols TLSv1.2 TLSv1.3;
}
```

#### Ma'lumotlarni shifrlash

**Database encryption**:

```python
from cryptography.fernet import Fernet

# Key yaratish
key = Fernet.generate_key()
cipher = Fernet(key)

# Shifrlash
encrypted = cipher.encrypt(b"Maxfiy ma'lumot")

# Deshifrlash
decrypted = cipher.decrypt(encrypted)
```

**Environmental variables**:

```bash
# .env fayl
DB_PASSWORD=secret123
API_KEY=abc123xyz

# Kod
import os
password = os.getenv('DB_PASSWORD')
```

**Never**:
- Parollarni kodga yozish
- Ma'lumotlarni plain text da saqlash
- Sezgir ma'lumotlarni log qilish

### 4. XML External Entities (XXE)

**XML zaiflik** - tashqi entitylarni qabul qilish.

**Zaif kod**:

```php
$xml = simplexml_load_string($_POST['xml']);
```

**Hujum**:

```xml
<!DOCTYPE foo [
    <!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<root>
    <data>&xxe;</data>
</root>
```

**Himoya**:

```php
// Disable external entities
libxml_disable_entity_loader(true);
```

### 5. Broken Access Control

**Ruxsatlar muammosi** - noto'g'ri kirish nazorati.

#### Insecure Direct Object Reference (IDOR)

**Zaif kod**:

```php
// /profile.php?user_id=123
$user_id = $_GET['user_id'];
$sql = "SELECT * FROM users WHERE id = $user_id";
```

**Hujum**: User_id ni o'zgartirib boshqa foydalanuvchilarni ko'rish.

**Himoya**:

```php
// Faqat o'z profilini ko'rish
$user_id = $_SESSION['user_id'];
$requested_id = $_GET['user_id'];

if ($user_id != $requested_id) {
    die("Access denied");
}
```

#### Privilege Escalation

**Vertikal**:
- Oddiy user admin bo'ladi

**Gorizontal**:
- User boshqa user ma'lumotlarini ko'radi

**Himoya**:

```php
function checkAdmin() {
    if (!isset($_SESSION['is_admin']) || $_SESSION['is_admin'] !== true) {
        header('Location: /login.php');
        exit();
    }
}

// Admin sahifa
checkAdmin();
```

### 6. Security Misconfiguration

**Noto'g'ri konfiguratsiya** - tizim sozlamalarida xatoliklar.

#### Default credentials

**Muammo**: Default parollar o'zgartirilmagan.

```
Username: admin
Password: admin
```

**Himoya**: Har doim o'zgartiring!

#### Directory Listing

**Muammo**: Papka tarkibi ochiq.

```
http://example.com/uploads/
- file1.pdf
- file2.jpg
- secret.txt
```

**Himoya**:

```apache
# Apache .htaccess
Options -Indexes
```

```nginx
# Nginx
autoindex off;
```

#### Debug mode

**Zaif**:

```php
// Production da
ini_set('display_errors', 1);
error_reporting(E_ALL);
```

**To'g'ri**:

```php
// Production
ini_set('display_errors', 0);
error_reporting(0);

// Log ga yozish
ini_set('log_errors', 1);
ini_set('error_log', '/var/log/php_errors.log');
```

#### Unnecessary services

**O'chirish kerak**:
- FTP (SFTP ishlatish)
- Telnet (SSH ishlatish)
- Eski PHP versiyalar

### 7. Cross-Site Scripting (XSS)

**XSS** - zararli JavaScript kiritish.

#### Reflected XSS

**Zaif kod**:

```php
// search.php
$query = $_GET['q'];
echo "Qidiruv natijalari: $query";
```

**Hujum**:

```
?q=<script>alert(document.cookie)</script>
```

**Himoya**:

```php
$query = htmlspecialchars($_GET['q'], ENT_QUOTES, 'UTF-8');
echo "Qidiruv natijalari: $query";
```

#### Stored XSS

**Muammo**: Database ga zararli kod saqlanadi.

**Zaif**:

```php
// Comment saqlash
$comment = $_POST['comment'];
$sql = "INSERT INTO comments (text) VALUES ('$comment')";

// Ko'rsatish
echo $comment;
```

**Hujum**: Har kim ko'rganda ishga tushadi.

**Himoya**:

```php
// Saqlashdan oldin
$comment = htmlspecialchars($_POST['comment'], ENT_QUOTES, 'UTF-8');

// Yoki ko'rsatishda
echo htmlspecialchars($comment, ENT_QUOTES, 'UTF-8');
```

#### DOM-based XSS

**JavaScript orqali**:

```javascript
// Zaif
document.getElementById('output').innerHTML = location.hash.substring(1);

// Xavfsiz
document.getElementById('output').textContent = location.hash.substring(1);
```

#### XSS dan himoya

**Content Security Policy (CSP)**:

```html
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'">
```

```nginx
# Nginx
add_header Content-Security-Policy "default-src 'self'; script-src 'self'";
```

### 8. Insecure Deserialization

**Deserialization zaiflik** - object ni restore qilishda xavf.

**PHP misol**:

```php
// Zaif
$data = unserialize($_COOKIE['data']);
```

**Himoya**:
- JSON ishlatish (serialize o'rniga)
- Input validation
- Type checking

### 9. Using Components with Known Vulnerabilities

**Eski kutubxonalar** - zaif dependencies.

**Muammo**:
- Eski PHP versiya
- Eski WordPress plugin
- Zaif npm package

**Himoya**:

```bash
# PHP Composer
composer update

# Node.js
npm audit
npm update

# Python
pip list --outdated
pip install -U package_name
```

**Monitoring**:
- Snyk
- Dependabot (GitHub)
- npm audit

### 10. Insufficient Logging & Monitoring

**Log va monitoring etishmasligi**.

**Nima log qilish kerak**:
- Login attempts (muvaffaqiyatli va muvaffaqiyatsiz)
- Password changes
- Admin actions
- Access control failures
- Input validation failures

**Nima log qilmaslik kerak**:
- Parollar
- Session ID lar
- Credit card ma'lumotlari

**PHP logging**:

```php
// Custom log
function logEvent($message, $level = 'INFO') {
    $logFile = '/var/log/myapp.log';
    $timestamp = date('Y-m-d H:i:s');
    $entry = "[$timestamp] [$level] $message\n";
    file_put_contents($logFile, $entry, FILE_APPEND);
}

// Ishlatish
logEvent("User login attempt: " . $username);
logEvent("Failed login: " . $username, 'WARNING');
```

## Dars uchun vazifa

1. SQL Injection test:
   - DVWA (Damn Vulnerable Web Application)
   - Oddiy SQL Injection
   - Screenshot

2. XSS test:
   - XSS Game (Google)
   - 3 ta level
   - Har biri uchun payload

3. Burp Suite:
   - O'rnating
   - Proxy sozlang
   - HTTP request intercept

4. Browser DevTools:
   - Network tab
   - Cookie lar
   - Local Storage

## Uyga vazifa

1. **Zaif web app yarating**:
   - Login form (SQL Injection zaif)
   - Comment form (XSS zaif)
   - Xavfli ekanini ko'rsating

2. **Xavfsiz versiya**:
   - Prepared statements
   - htmlspecialchars()
   - Input validation

3. Quyidagi savolarga javob bering:
   - SQL Injection qanday ishlaydi?
   - XSS va CSRF farqi?
   - Parolni qanday saqlash kerak?
   - HTTPS nima uchun muhim?

4. **Security Checklist yarating**:
   - OWASP Top 10
   - Har biri uchun:
     * Tavsif
     * Misol
     * Himoya usuli

5. **Password Policy**:
   - Minimal uzunlik
   - Complexity requirements
   - PHP/Python da implement qiling

6. **Login System (Xavfsiz)**:
   - Prepared statements
   - Bcrypt hash
   - Session management
   - Rate limiting

7. **Log System**:
   - File ga yozish
   - Timestamp
   - Log levels (INFO, WARNING, ERROR)
   - Rotation

8. Penetration test qiling:
   - DVWA
   - SQL Injection
   - XSS
   - CSRF
   - File Upload
   - Report yozing

9. **CSP Header qo'shing**:
   - Nginx yoki Apache
   - Script-src, style-src
   - Test qiling

10. **Vulnerability Scanner**:
    - OWASP ZAP o'rnating
    - Test saytga scan
    - Report tahlil qiling
